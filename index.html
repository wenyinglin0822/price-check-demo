<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åº—å…§æŸ¥åƒ¹ç³»çµ±ï¼ˆæ‰‹æ©Ÿå¯æƒç¢¼ï¼‰</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="app-container">
        <header class="app-header">
            <h1 class="app-title">åº—å…§æŸ¥åƒ¹ç³»çµ±ï¼ˆæ‰‹æ©Ÿå¯æƒç¢¼ï¼‰</h1>
        </header>

        <section class="search-section">
            <div class="input-group">
                <label class="input-label">è«‹è¼¸å…¥æˆ–æƒæå•†å“æ¢ç¢¼ï¼š</label>
                <input id="barcode-input" type="text" class="barcode-input" autocomplete="off">
            </div>

            <div class="button-row">
                <button id="search-btn" class="btn primary">æŸ¥è©¢</button>
                <button id="scan-btn" class="btn accent">ğŸ“· æƒææ¢ç¢¼</button>
            </div>

            <div class="support-note">
                æ”¯æ´ï¼šEAN-13 / EAN-8 / UPC / Code128 / QRCode
            </div>
        </section>

        <section class="demo-section">
            <div id="demo-panel" class="demo-panel">
                <div id="demo-content" class="demo-content">DEMO å·¦</div>
            </div>
            <div class="demo-buttons">
                <button class="btn demo-btn active" data-demo="left">åœ– 1</button>
                <button class="btn demo-btn" data-demo="center">åœ– 2</button>
                <button class="btn demo-btn" data-demo="right">åœ– 3</button>
            </div>
        </section>

        <section class="result-section">
            <div id="result-panel" class="result-panel"></div>
        </section>
    </div>

    <!-- æ¢ç¢¼æƒæ UI -->
    <div id="scanner-overlay" class="scanner-overlay" style="display:none;">
        <div class="scanner-dialog">
            <div class="scanner-header">
                <span>è«‹å°‡æ¢ç¢¼å°æº–ç•«é¢ä¸­ç·š</span>
                <button id="close-scanner-btn" class="close-btn">âœ•</button>
            </div>
            <div id="scanner-area" class="scanner-area">
                <video id="scanner-video" class="scanner-video" autoplay muted playsinline></video>
                <div class="scanner-line"></div>
            </div>
        </div>
    </div>

    <!-- ä¸€å®šè¦ç”¨ /static/... é€™ç¨®çµ•å°è·¯å¾‘ -->
    <script src="/static/quagga.min.js"></script>
    <script src="/static/script.js"></script>

    <!-- å‰ç«¯å¯†ç¢¼ + 30 åˆ†é˜ session + å€’æ•¸è¨ˆæ™‚ -->
    <script>
    (function(){
        const KEY = "priceCheckExpire";
        const LIFE = 30 * 60 * 1000; // 30 åˆ†é˜

        function todayCode() {
            const d = new Date();
            const mmdd = (d.getMonth() + 1) * 100 + d.getDate(); // MMDD
            return mmdd + 1234;
        }

        function startCountdown(expire) {
            const el = document.createElement("div");
            el.style.position = "fixed";
            el.style.right = "10px";
            el.style.bottom = "10px";
            el.style.background = "#ffffff";
            el.style.border = "1px solid #ccc";
            el.style.padding = "5px 12px";
            el.style.borderRadius = "6px";
            el.style.fontSize = "12px";
            el.style.zIndex = "9999";
            document.body.appendChild(el);

            function tick() {
                const now = Date.now();
                const diff = expire - now;
                if (diff <= 0) {
                    sessionStorage.removeItem(KEY);
                    alert("ä½¿ç”¨æ™‚é–“å·²åˆ°ï¼Œè«‹é‡æ–°è¼¸å…¥å¯†ç¢¼");
                    location.reload();
                    return;
                }
                const sec = Math.floor(diff / 1000);
                const mm = String(Math.floor(sec / 60)).padStart(2, "0");
                const ss = String(sec % 60).padStart(2, "0");
                el.textContent = `å‰©é¤˜æ™‚é–“ï¼š${mm}:${ss}`;
            }
            tick();
            setInterval(tick, 1000);
        }

        function ensureLogin() {
            const now = Date.now();
            const saved = Number(sessionStorage.getItem(KEY) || 0);
            if (saved > now) {
                startCountdown(saved);
                return;
            }

            while (true) {
                const input = prompt("è«‹è¼¸å…¥å¯†ç¢¼");
                if (input === null) {
                    alert("æœªè¼¸å…¥å¯†ç¢¼ï¼Œå·²é›¢é–‹ç³»çµ±");
                    location.href = "about:blank";
                    return;
                }
                if (input.trim() === String(todayCode())) {
                    const expire = Date.now() + LIFE;
                    sessionStorage.setItem(KEY, expire);
                    startCountdown(expire);
                    return;
                }
                alert("å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡");
            }
        }

        window.addEventListener("load", ensureLogin);
    })();
    </script>

</body>
</html>
